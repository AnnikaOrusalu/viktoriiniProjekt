<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Online Quiz">
    <meta name="keywords" content="quiz">
    <meta name="author" content="Annika, Erik, Lauri">
    <title>Online Viktoriin | Mängima</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
<header>
    <div class="container">
        <div id="branding">
            <h1><span class="highlight">Online</span> Viktoriin</h1>
        </div>
        <nav>
            <ul>
                <li><a href="index.html">esileht</a></li>
                <li class="current"><a href="m2ngima.html">mängima</a></li>
                <li><a href="admin.html">admin</a></li>
            </ul>
        </nav>
    </div>
</header>


<section id="main">
    <div class="container">
        <article id="main-col">
            <h1 class="page-title">Alusta mängu!</h1>
            <ul id="services">
                <li>
                    <h3>Vali õige vastsus ja kliki jätka!</h3>
                    <!--                    <p>Mängu lõpus saad teada tulemuse.</p>-->
                </li>
            </ul>
        </article>

        <aside id="sidebar">
            <div class="dark">
                <h3><input id="question" type="text" disabled></h3>
                <form class="quote">
                    <div>
                        <label>Vastus 1:</label><br>
                        <input type="radio" id="answerButton1" name="checker" value=0>
                        <input id="answer1" type="text" disabled>
                    </div>
                    <div>
                        <label>Vastus 2:</label><br>
                        <input type="radio" id="answerButton2" name="checker" value=1>
                        <input id="answer2" type="text" disabled>
                    </div>
                    <div>
                        <label>Vastus 3:</label><br>
                        <input type="radio" id="answerButton3" name="checker" value=2>
                        <input id="answer3" type="text" disabled>
                    </div>
                    <div>
                        <label>Vastus 4:</label><br>
                        <input type="radio" id="answerButton4" name="checker" value=3>
                        <input id="answer4" type="text" disabled>
                    </div>
                    <br>
                    <button class="button_1" type="button" onclick="clickTheButton()">Enter</button>
                    <div>
                        <label>Sinu pakkumine oli:</label><br>
                        <input id="answerWasRightOrWrong" type="text" disabled>
                    </div>
                </form>
            </div>
        </aside>
    </div>
</section>


<script>

    const postUrl = '/quiz/questionAndAnswers/'
    const questionsUrl = '/quiz/questionIds'
    const postUrl2 = '/quiz/buttonValue'
    let questionIds = []; //defineerib uue tühja Array
    let questionIndex = 0; //algab indeksist 0, et hiljem saaks juurde liita ja minna järgmise küsimuse juurde
    let points = 0; //loeb vastuste punkte

    //2. küsib välja andmebaasist kõik question_id-d
    function getQuestionIds() {
        fetch(questionsUrl)
            .then(result => result.json())
            .then(function (result) {
                console.log(result)
                // 3. paneb question_id-d random järjekorda
                questionIds = result.sort(() => Math.random() - 0.5);
                // 4. käib random järjekorras kõik question_id-d läbi.
                // käivitab getQuestionsAndAnswers meetodi
                getQuestionsAndAnswers(questionIds[questionIndex])
            })
        // Kysime kysimuse ID
        // Paneme nad array
    }
    //5.kuvab küsimuse ja vastused etteantud lahtritesse
    function getQuestionsAndAnswers(questionId) {
        fetch(postUrl + questionId)
            .then(result => result.json())
            .then(function (result) {
                // question text
                let questionElement = document.getElementById("question");
                questionElement.value = result.questionText;
                // answer text
                let answer1Element = document.getElementById("answer1");
                let answer2Element = document.getElementById("answer2");
                let answer3Element = document.getElementById("answer3");
                let answer4Element = document.getElementById("answer4");
                // buttons
                let button1Element = document.getElementById("answerButton1");
                let button2Element = document.getElementById("answerButton2");
                let button3Element = document.getElementById("answerButton3");
                let button4Element = document.getElementById("answerButton4");
                // answersId assigned to a button
                button1Element.value = result.answerTexts[0].id;
                button2Element.value = result.answerTexts[1].id;
                button3Element.value = result.answerTexts[2].id;
                button4Element.value = result.answerTexts[3].id;
                // answer text on corresponding fields
                answer1Element.value = result.answerTexts[0].text;
                answer2Element.value = result.answerTexts[1].text;
                answer3Element.value = result.answerTexts[2].text;
                answer4Element.value = result.answerTexts[3].text;
            })

    }
    //6.Enter nuppu vajutades käivitub clickTheButton funktsioon
    function clickTheButton() {
        // kontrollib üle kõik 4 nuppu
        let ele = document.getElementsByName('checker');
        let buttonValue = 0;
        for (let i = 0; i < ele.length; i++) {
            // KUI nupp kohal i on valitud
            if (ele[i].checked) {
                buttonValue = ele[i].value;
                // SIIS kontrolli kas valitud on õige küsimuse nupp
                // ehk kontrolli kas valitud küsimuse true_false väärtus on 1  või 0
                //kui nupp on valitud siis uuendab buttonValue nupu väärtusega
            }
        }
        //kui buttonValue on 0 siis annab alerti
        if (buttonValue == 0) {
            alert("Vali õige vastus!")
        } else {
            //saadab Jsoniga nupu väärtuse serverisse
            let userAnswer = {
                userAnswer: buttonValue,
            }
            fetch(postUrl2,
                {
                    method: 'POST',
                    headers: {
                        'Content-type': 'application/json'
                    },
                    body: JSON.stringify(userAnswer)
                })
                //võtab serverist tulemuse vastu
                .then(result => result.json())
                // paneb tööle funktsiooni
                .then(function (isCorrectAnswer) {
                    //isCorrectAnswer sisaldab kasutaja valitud küsimuse true_false väärtust
                    console.log(isCorrectAnswer)
                    //kuvab lahtrisse välja kas vastus on õige või vale
                    let answerElement = document.getElementById("answerWasRightOrWrong");
                    //kui vastus on õige siis liidab 5 punkti ja kuvad teate koos tulemusega
                    if (isCorrectAnswer) {
                        points = points + 5
                        answerElement.value = "Tubli! Sul on: " + points + " punkti."
                    // kui vastus vale siis lahutab ühe puntki ja kuvab teate koos tulemusega
                    } else {
                        points--
                        answerElement.value = "Väga paha! Sul on: " + points + " punkti."

                    }
                    // Liidab indexile 1, et küsida järgmine küsimuse
                    questionIndex++
                    // Kui index on väiksem kui küsimuste arv siis küsi uus küsimus
                    if (questionIndex < questionIds.length) {
                        //küsib järgmise küsimuse mis on random array-s järjekorra numbriga questionIndex
                        getQuestionsAndAnswers(questionIds[questionIndex])
                    } else {
                        answerElement.value = "Kahjuks rohkem kysimusi ei ole praegu!! Said " + points + " punkti"
                    }
                })
        }

    }
    //1. lehe laadides läheb tööle kõigepealt see meetod
    getQuestionIds()

</script>
<footer>
    Vali-IT Quiz Team &copy; 2021
</footer>
</body>
</html>
